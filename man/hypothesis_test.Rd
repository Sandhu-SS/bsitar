% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/hypothesis_test.R
\name{hypothesis_test.bgmfit}
\alias{hypothesis_test.bgmfit}
\alias{hypothesis_test}
\title{Comprehensive hypothesis testing framework for the Bayesian SITAR model}
\usage{
\method{hypothesis_test}{bgmfit}(
  model,
  by = NULL,
  hypothesis = NULL,
  hypothesis_str = NULL,
  parameters = NULL,
  parameter = NULL,
  class = "b",
  group = "",
  scope = c("standard", "ranef", "coef"),
  robust = FALSE,
  seed = NULL,
  equivalence_test = NULL,
  p_direction = NULL,
  evaluate_equivalence = NULL,
  evaluate_pdirection = NULL,
  range = "default",
  method = "direct",
  null = NULL,
  as_p = FALSE,
  remove_na = TRUE,
  rvar_col = NULL,
  effects = "fixed",
  component = "conditional",
  evaluate_comparison = NULL,
  comparison_by = NULL,
  comparison_range_null = NULL,
  comparison_range = NULL,
  comparison_null = NULL,
  evaluate_hypothesis = NULL,
  hypothesis_by = NULL,
  hypothesis_range_null = NULL,
  hypothesis_range = NULL,
  hypothesis_null = NULL,
  rope_as_percent = TRUE,
  pd_as_percent = TRUE,
  format = NULL,
  reformat = TRUE,
  estimate_center = NULL,
  estimate_interval = NULL,
  na.rm = TRUE,
  alpha = 0.05,
  ci = 0.95,
  conf_level = NULL,
  probs = c(0.025, 0.975),
  get_range_null_form = NULL,
  get_range_null_value = NULL,
  plot = FALSE,
  digits = 2,
  engine = NULL,
  usesavedfuns = FALSE,
  verbose = FALSE,
  envir = NULL,
  ...
)

hypothesis_test(model, ...)
}
\arguments{
\item{model}{A fitted model object of class \code{bgmfit}, or a posterior
data frame. See Details for engine-specific support.}

\item{by}{Optional grouping variable(s) used to stratify summaries or
comparisons. The exact meaning depends on the selected engine and methods.}

\item{hypothesis}{specify a hypothesis test or custom contrast using a number , formula, string equation, vector, matrix, or function.
\itemize{
\item Number: The null hypothesis used in the computation of Z and p (before applying \code{transform}).
\item String: Equation to specify linear or non-linear hypothesis tests. Two-tailed tests must include an equal \code{=} sign. One-tailed tests must start with \code{<} or \code{>}. If the terms in \code{coef(object)} uniquely identify estimates, they can be used in the formula. Otherwise, use \code{b1}, \code{b2}, etc. to identify the position of each parameter. The \verb{b*} wildcard can be used to test hypotheses on all estimates. When the hypothesis string represents a two-sided equation, the \code{estimate} column holds the value of the left side minus the right side of the equation. If a named vector is used, the names are used as labels in the output. Examples:
\itemize{
\item \code{hp = drat}
\item \code{hp + drat = 12}
\item \code{b1 + b2 + b3 = 0}
\item \verb{b* / b1 = 1}
\item \verb{<= 0}
\item \verb{>= -3.5}
\item \code{b1 >= 10}
}
\item Formula: \code{lhs ~ rhs | group}
\itemize{
\item \code{lhs}
\itemize{
\item \code{ratio} (null = 1)
\item \code{difference} (null = 0)
\item Leave empty for default value
}
\item \code{rhs}
\itemize{
\item \code{pairwise} and \code{revpairwise}: pairwise differences between estimates in each row.
\item \code{reference}: differences between the estimates in each row and the estimate in the first row.
\item \code{sequential}: difference between an estimate and the estimate in the next row.
\item \code{meandev}: difference between an estimate and the mean of all estimates.
\item \code{meanotherdev}: difference between an estimate and the mean of all other estimates, excluding the current one.
\item \code{poly}: polynomial contrasts, as computed by the \code{stats::contr.poly()} function.
\item \code{helmert}: Helmert contrasts, as computed by the \code{stats::contr.helmert()} function. Contrast 2nd level to the first, 3rd to the average of the first two, and so on.
\item \code{trt_vs_ctrl}: difference between the mean of estimates (except the first) and the first estimate.
\item \code{I(fun(x))}: custom function to manipulate the vector of estimates \code{x}. The function \code{fun()} can return multiple (potentially named) estimates.
}
\item \code{group} (optional)
\itemize{
\item Column name of \code{newdata}. Conduct hypothesis tests withing subsets of the data.
}
\item Examples:
\itemize{
\item \code{~ poly}
\item \code{~ sequential | groupid}
\item \code{~ reference}
\item \code{ratio ~ pairwise}
\item \code{difference ~ pairwise | groupid}
\item \code{~ I(x - mean(x)) | groupid}
\item \verb{~ I(\\(x) c(a = x[1], b = mean(x[2:3]))) | groupid}
}
}
\item Matrix or Vector: Each column is a vector of weights. The the output is the dot product between these vectors of weights and the vector of estimates. The matrix can have column names to label the estimates.
\item Function:
\itemize{
\item Accepts an argument \code{x}: object produced by a \code{marginaleffects} function or a data frame with column \code{rowid} and \code{estimate}
\item Returns a data frame with columns \code{term} and \code{estimate} (mandatory) and \code{rowid} (optional).
\item The function can also accept optional input arguments: \code{newdata}, \code{by}, \code{draws}.
\item This function approach will not work for Bayesian models or with bootstrapping. In those cases, it is easy to use \code{get_draws()} to extract and manipulate the draws directly.
}
\item See the Examples section below and the vignette: \url{https://marginaleffects.com/chapters/hypothesis.html}
\item Warning: When calling \code{predictions()} with \code{type="invlink(link)"} (the default in some models), \code{hypothesis} is tested and p values are computed on the link scale.
}}

\item{hypothesis_str}{A character vector specifying one or more non-linear
hypothesis concerning parameters of the model. Note that the argument
\code{hypothesis_str} is the renamed version of the \code{hypothesis}
argument for the \code{\link[brms:hypothesis.brmsfit]{brms::hypothesis()}}. This renaming is done to avoid
conflicts with the \code{hypothesis} argument for the
\code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}}.}

\item{parameters}{Regular expression pattern that describes the parameters
that should be returned. Meta-parameters (like \code{lp__} or \code{prior_}) are
filtered by default, so only parameters that typically appear in the
\code{summary()} are returned. Use \code{parameters} to select specific parameters
for the output.}

\item{parameter}{A single character string or a character vector specifying
the growth parameter(s) to be estimated. Options include \code{'tgv'}
(takeoff growth velocity), \code{'atgv'} (age at takeoff growth velocity),
\code{'pgv'} (peak growth velocity), \code{'apgv'} (age at peak growth
velocity), \code{'cgv'} (cessation growth velocity), \code{'acgv'} (age at
cessation growth velocity), and \code{'all'}. If \code{parameter = NULL}
(default), age at peak growth velocity (\code{'apgv'}) is estimated. When
\code{parameter = 'all'}, all six parameters are estimated. Note that the
\code{'all'} option cannot be used when the \code{by} argument is set to
\code{TRUE}.}

\item{class}{A string specifying the class of parameters being tested.
Default is "b" for population-level effects.
Other typical options are "sd" or "cor".
If \code{class = NULL}, all parameters can be tested
against each other, but have to be specified with their full name
(see also \code{\link[brms:draws-index-brms]{variables}})}

\item{group}{Name of a grouping factor to evaluate only
group-level effects parameters related to this grouping factor.}

\item{scope}{Indicates where to look for the variables specified in
\code{hypothesis}. If \code{"standard"}, use the full parameter names
(subject to the restriction given by \code{class} and \code{group}).
If \code{"coef"} or \code{"ranef"}, compute the hypothesis for all levels
of the grouping factor given in \code{"group"}, based on the
output of \code{\link[brms]{coef.brmsfit}} and \code{\link[brms]{ranef.brmsfit}},
respectively.}

\item{robust}{If \code{FALSE} (the default) the mean is used as
the measure of central tendency and the standard deviation as
the measure of variability. If \code{TRUE}, the median and the
median absolute deviation (MAD) are applied instead.}

\item{seed}{A single numeric value passed to \code{\link{set.seed}}
to make results reproducible. This is currently only relevant for point
hypotheses that scope over at least two parameters (see Details).}

\item{equivalence_test}{Logical; if \code{TRUE}, run ROPE-based practical
equivalence testing via \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}.}

\item{p_direction}{Logical; if \code{TRUE}, compute probability of direction
via \code{\link[bayestestR:p_direction]{bayestestR::p_direction()}}.}

\item{evaluate_equivalence}{Logical; if \code{TRUE}, run ROPE-based practical
equivalence testing via \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}. This is rarely
used because appropriate setting \code{TRUE/FALSE} is assigned automatically
depending on the \code{equivalence_test}.}

\item{evaluate_pdirection}{Logical; if \code{TRUE}, compute probability of
direction via \code{\link[bayestestR:p_direction]{bayestestR::p_direction()}}. This is rarely
used because appropriate setting \code{TRUE/FALSE} is assigned automatically
depending on the \code{p_direction}.}

\item{range}{ROPE's lower and higher bounds. Should be \code{"default"} or
depending on the number of outcome variables a vector or a list. For models
with one response, \code{range} can be:
\itemize{
\item a vector of length two (e.g., \code{c(-0.1, 0.1)}),
\item a list of numeric vector of the same length as numbers of parameters (see
'Examples').
\item a list of \emph{named} numeric vectors, where names correspond to parameter
names. In this case, all parameters that have no matching name in \code{range}
will be set to \code{"default"}.
}

In multivariate models, \code{range} should be a list with another list (one for
each response variable) of numeric vectors . Vector names should correspond to
the name of the response variables. If \code{"default"} and input is a vector, the
range is set to \code{c(-0.1, 0.1)}. If \code{"default"} and input is a Bayesian model,
\code{\link[bayestestR:rope_range]{rope_range()}} is used. See 'Examples'.}

\item{method}{Can be \code{"direct"} or one of methods of \code{\link[bayestestR:estimate_density]{estimate_density()}},
such as \code{"kernel"}, \code{"logspline"} or \code{"KernSmooth"}. See details.}

\item{null}{The value considered as a "null" effect. Traditionally 0, but
could also be 1 in the case of ratios of change (OR, IRR, ...).}

\item{as_p}{If \code{TRUE}, the p-direction (pd) values are converted to a
frequentist p-value using \code{\link[bayestestR:pd_to_p]{pd_to_p()}}.}

\item{remove_na}{Should missing values be removed before computation? Note
that \code{Inf} (infinity) are \emph{not} removed.}

\item{rvar_col}{A single character - the name of an \code{rvar} column in the data
frame to be processed. See example in \code{\link[bayestestR:p_direction]{p_direction()}}.}

\item{effects}{Should variables for fixed effects (\code{"fixed"}), random effects
(\code{"random"}) or both (\code{"all"}) be returned? Only applies to mixed models. May
be abbreviated.

For models of from packages \strong{brms} or \strong{rstanarm} there are additional
options:
\itemize{
\item \code{"fixed"} returns fixed effects.
\item \code{"random_variance"} return random effects parameters (variance and
correlation components, e.g. those parameters that start with \code{sd_} or
\code{cor_}).
\item \code{"grouplevel"} returns random effects group level estimates, i.e. those
parameters that start with \code{r_}.
\item \code{"random"} returns both \code{"random_variance"} and \code{"grouplevel"}.
\item \code{"all"} returns fixed effects and random effects variances.
\item \code{"full"} returns all parameters.
}}

\item{component}{Which type of parameters to return, such as parameters for
the conditional model, the zero-inflated part of the model, the dispersion
term, etc. See details in section \emph{Model Components}. May be abbreviated.
Note that the \emph{conditional} component also refers to the \emph{count} or \emph{mean}
component - names may differ, depending on the modeling package. There are
three convenient shortcuts (not applicable to \emph{all} model classes):
\itemize{
\item \code{component = "all"} returns all possible parameters.
\item If \code{component = "location"}, location parameters such as \code{conditional},
\code{zero_inflated}, \code{smooth_terms}, or \code{instruments} are returned (everything
that are fixed or random effects - depending on the \code{effects} argument -
but no auxiliary parameters).
\item For \code{component = "distributional"} (or \code{"auxiliary"}), components like
\code{sigma}, \code{dispersion}, \code{beta} or \code{precision} (and other auxiliary
parameters) are returned.
}}

\item{evaluate_comparison}{Logical indicating whether to compute and return
comparisons from \code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}} via the
\code{\link[=marginal_growthparameters]{marginal_growthparameters()}}. Defaults to \code{NULL}, in which case it is
automatically determined from other arguments. Only
evaluated when \code{model} is class \code{"bsitar"} and \code{engine =
  "marginaleffects" or "mbcombo"}.}

\item{comparison_by}{Character string specifying the \code{by} variable for
comparisons. Defaults to \code{NULL}, in which case it is inferred from the
\code{by} argument.}

\item{comparison_range_null}{Data frame with columns \code{parameter},
\code{by} variables, \code{range} (for \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}),
and \code{null} (for \code{\link[bayestestR:p_direction]{bayestestR::p_direction()}}). Defaults to \code{NULL},
in which case \code{range} and \code{null} values are set automatically.}

\item{comparison_range}{Like \code{comparison_range_null} but without the
\code{null} column. Used when \code{equivalence_test = TRUE} and
\code{p_direction = FALSE}.}

\item{comparison_null}{Like \code{comparison_range_null} but without the
\code{range} column. Used when \code{equivalence_test = FALSE} and
\code{p_direction = TRUE}.}

\item{evaluate_hypothesis}{Logical indicating whether to compute and return
hypothesis from \code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}} via the
\code{\link[=marginal_growthparameters]{marginal_growthparameters()}}. Defaults to \code{NULL}, in which case it is
automatically determined from other arguments. Only
evaluated when \code{model} is class \code{"bsitar"} and \code{engine =
  "marginaleffects" or "mbcombo"}.}

\item{hypothesis_by}{Character string specifying the \code{by} variable for
hypotheses. Defaults to \code{NULL}, in which case it is inferred from the
\code{by} argument.}

\item{hypothesis_range_null}{Data frame with columns \code{parameter},
\code{by} variables, \code{range} (for \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}),
and \code{null} (for \code{\link[bayestestR:p_direction]{bayestestR::p_direction()}}). Defaults to \code{NULL},
in which case \code{range} and \code{null} values are set automatically.}

\item{hypothesis_range}{Like \code{hypothesis_range_null} but without the
\code{null} column. Used when \code{equivalence_test = TRUE} and
\code{p_direction = FALSE}.}

\item{hypothesis_null}{Like \code{hypothesis_range_null} but without the
\code{range} column. Used when \code{equivalence_test = FALSE} and
\code{p_direction = TRUE}.}

\item{rope_as_percent}{Logical indicating whether to return ROPE results as
percentages (\code{TRUE}, default) or fractions (\code{FALSE}). Only
evaluated when \code{model} is class \code{"bsitar"} and \code{engine} is
\code{"bayestestR"} or \code{"mbcombo"}.}

\item{pd_as_percent}{Logical indicating whether to return PD results as
percentages (\code{TRUE}, default) or fractions (\code{FALSE}). Only
evaluated when \code{model} is class \code{"bsitar"} and \code{engine} is
\code{"bayestestR"} or \code{"mbcombo"}.}

\item{format}{Logical; if \code{TRUE}, merge interval-bound columns returned
by \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}} into compact range columns.
Specifically, \code{ROPE_low} and \code{ROPE_high} are combined into
\code{ROPE_range}, and \code{HDI_low} and \code{HDI_high} are combined into
\code{HDI_range}. This option only modifies results originating from
\code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}.}

\item{reformat}{Logical; if \code{TRUE}, post-process the data frame returned
by \code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}} to make it consistent with
posterior-summary conventions. This includes renaming interval columns such
as \code{conf.low} to \code{Q2.5} and \code{conf.high} to \code{Q97.5}, and
optionally dropping columns which are often not needed for reporting (e.g.,
\code{term}, \code{contrast}, etc.).}

\item{estimate_center}{A character string (default \code{NULL}) specifying
how to center estimates: either \code{'mean'} or \code{'median'}. This
option sets the global options as follows:
\code{options("marginaleffects_posterior_center" = "mean")} or
\code{options("marginaleffects_posterior_center" = "median")}. These global
options are restored upon function exit using \code{\link[base:on.exit]{base::on.exit()}}.}

\item{estimate_interval}{A character string (default \code{NULL}) to specify
the type of credible intervals: \code{'eti'} for equal-tailed intervals or
\code{'hdi'} for highest density intervals. This option sets the global
options as follows: \code{options("marginaleffects_posterior_interval" =
  "eti")} or \code{options("marginaleffects_posterior_interval" = "hdi")},
and is restored on exit using \code{\link[base:on.exit]{base::on.exit()}}.}

\item{na.rm}{Logical; if \code{TRUE} (default), then remove \code{NA} values.}

\item{alpha}{Alpha level for hypothesis tests used in \code{\link[brms:hypothesis.brmsfit]{brms::hypothesis()}}.
The default is \code{NULL}, in which case \code{alpha} is inferred from
\code{probs}. With the default \code{probs}, this corresponds to
\code{alpha = 0.05}, which is also the default in \code{\link[brms:hypothesis.brmsfit]{brms::hypothesis()}}.}

\item{ci}{Confidence level used in \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}} and
\code{\link[bayestestR:p_direction]{bayestestR::p_direction()}}. The default is \code{NULL}, in which case
\code{ci} is inferred from \code{probs}. With the default \code{probs},
this corresponds to \code{ci = 0.95}, which matches the defaults in those
functions.}

\item{conf_level}{Confidence level used in \code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}}.
The default is \code{NULL}, in which case \code{conf_level} is inferred
from \code{probs}. With the default \code{probs}, this corresponds to
\code{conf_level = 0.95}, which is also the default in
\code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}}. Note that if \code{probs = NULL}, then
\code{conf_level} is used to determine the \code{probs} as well as the
\code{alpha} and \code{ci} (see below).}

\item{probs}{Probability levels for credible intervals. Defaults to
\code{c(0.025, 0.975)} (95\\% credible intervals). Also determines default
values for \code{alpha}, \code{ci}, and \code{conf_level} when those are
\code{NULL} (see below).}

\item{get_range_null_form}{Logical; if \code{TRUE}, return the expected
structure of \code{range} (\code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}) and
\code{null} (\code{\link[bayestestR:p_direction]{bayestestR::p_direction()}}) values. User can use this format
to set the \code{range} and \code{null} values that are then passed to the
\code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}} and \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}} via
\code{comparison_range_null} and \code{hypothesis_range_null}.}

\item{get_range_null_value}{Logical; if \code{TRUE}, return the default
\code{range} (\code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}) and \code{null}
(\code{\link[bayestestR:p_direction]{bayestestR::p_direction()}}) values that are used to set up the
\code{range} and \code{null} values for \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}
and \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}.}

\item{plot}{Logical or a character string \code{"return"}; if \code{TRUE},
plot the hypothesis test results and return the data frame. Set \code{plot
  = "return"} to return the plot object itself instead of the data frame.
Note that only \code{\link[brms:hypothesis.brmsfit]{brms::hypothesis()}} and \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}
support plotting.}

\item{digits}{Number of digits to use when printing numeric results. Default
\code{2}.}

\item{engine}{Optional engine selector specifying which backend(s) to use:
\itemize{
\item \code{"brms"} for \code{\link[brms:hypothesis.brmsfit]{brms::hypothesis()}} non-linear hypothesis
testing
\item \code{"bayestestR"} for \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}} (ROPE) and
\code{\link[bayestestR:p_direction]{bayestestR::p_direction()}} (PD) testing
\item \code{"marginaleffects"} for \code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}}
pairwise/contrast comparisons
\item \code{"mbcombo"} for combined \pkg{marginaleffects} and
\pkg{bayestestR} workflows
\item \code{NULL} (default) automatically selects appropriate engine(s)
based on \code{model} class and requested analyses
}}

\item{usesavedfuns}{A logical value (default \code{NULL}) indicating whether
to use already exposed and saved Stan functions. This is typically set
automatically based on the \code{expose_functions} argument from the
\code{\link[=bsitar]{bsitar()}} call. Manual specification of \code{usesavedfuns} is rarely
needed and is intended for internal testing, as improper use can lead to
unreliable estimates.}

\item{verbose}{Toggle off warnings.}

\item{envir}{The environment used for function evaluation. The default is
\code{NULL}, which sets the environment to \code{parent.frame()}. Since
most post-processing functions rely on \pkg{brms}, it is recommended to set
\code{envir = globalenv()} or \code{envir = .GlobalEnv}, especially for
derivatives like velocity curves.}

\item{...}{Additional arguments forwarded to \code{\link[=marginal_growthparameters]{marginal_growthparameters()}}}
}
\value{
An object (typically a list) containing some or all of the following
components, depending on the requested analyses and available methods:
\itemize{
\item A \code{\link[brms:hypothesis.brmsfit]{brms::hypothesis()}} result object for hypothesis tests.
\item A \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}} result for ROPE and practical
equivalence.
\item A \code{\link[bayestestR:p_direction]{bayestestR::p_direction()}} result for probability of direction.
\item A \code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}} result for contrasts between
predictions.
}
}
\description{
Performs non-linear hypothesis testing via \code{\link[brms:hypothesis.brmsfit]{brms::hypothesis()}}, Test for
Practical Equivalence via \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}, probability of
direction via \code{\link[bayestestR:p_direction]{bayestestR::p_direction()}}, and pairwise and contrast-style
comparisons via \code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}}, using a unified interface.

Test for Practical Equivalence, which is based on the Region of Practical
Equivalence (\code{ROPE}) and posterior credible intervals such as the High
Density Intervals (\code{HDI}), check whether parameter values should be
accepted or rejected against an explicitly formulated "null hypothesis"
(i.e., a \code{ROPE}). In other words, it checks the percentage of the
\code{HDI} such as 95\\%⁠ that is the null region (the \code{ROPE}). If this
percentage is sufficiently low, the null hypothesis is rejected. If this
percentage is sufficiently high, the null hypothesis is accepted.  If the HDI
is completely outside the \code{ROPE}, the "null hypothesis" for this
parameter is "rejected". If the \code{ROPE} completely covers the HDI, i.e.,
all most credible values of a parameter are inside the region of practical
equivalence, the null hypothesis is accepted. Else, it is undecided whether
to accept or reject the null hypothesis. If the full \code{ROPE} is used
(i.e., ⁠100\%⁠ of the HDI), then the null hypothesis is rejected or accepted
if the percentage of the posterior within the \code{ROPE} is smaller than to
⁠2.\5\%⁠ or greater than ⁠97.\5\%⁠. Desirable results are low proportions
inside the \code{ROPE} (the closer to zero the better). See
\code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}} for further details.

Probability of Direction (\code{pd}, also known as the Maximum Probability of
Effect \code{MPE}) is the probability that a parameter (described by its
posterior distribution) is strictly positive or negative (whichever is the
most probable). Although differently expressed, this index is fairly similar
(i.e., is strongly correlated) to the frequentist p-value (see details). See
\code{\link[bayestestR:p_direction]{bayestestR::p_direction()}} for further details.
}
\details{
This function collects arguments from multiple upstream packages:
\itemize{
\item \code{hypothesis_test} arguments (e.g., \code{hypothesis},
\code{class}, \code{scope}, \code{alpha}, \code{robust}, \code{seed}) map
to \code{\link[brms:hypothesis.brmsfit]{brms::hypothesis()}} and, in particular,
\code{scope} controls where hypothesis components referenced in
\code{hypothesis} are looked up. Note that to avoid conflicts with the
\code{hypothesis} argument from
\code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}},
the \code{hypothesis} argument for the brms package is renamed as
\code{hypothesis_str}. In other words, the \code{hypothesis_str} (see
below) is used to setup the
\code{hypothesis} argument when calling the
\code{\link[brms:hypothesis.brmsfit]{brms::hypothesis()}}.
\item
\code{equivalence_test} arguments (e.g., \code{range}, \code{ci},
\code{remove_na}, \code{parameters}) map to
\code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}}
for ROPE-based practical equivalence decisions.
\item \code{p_direction} arguments (e.g., \code{method}, \code{null},
\code{ci}, \code{remove_na}, \code{parameters}) map to
\code{\link[bayestestR:p_direction]{bayestestR::p_direction()}} for
probability of direction based practical decisions.
\item Additional arguments in \code{...} are forwarded to
\code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}}
via \code{marginal_growthparameters} to compute contrasts between
predictions under different predictor values.
}

Users should supply either \code{hypothesis_str} (\pkg{brms} hypothesis),
\code{parameters} (\pkg{bayestestR}), or \code{parameter}
(growth-parameter selector used by this package), but not multiple
overlapping selectors.

Supported inputs: \code{bgmfit} objects (via all three packages),
posterior data frames (via \pkg{brms} and \pkg{bayestestR} methods), or
\code{brmsfit} objects (via brms).
}
\examples{
\donttest{
# Fit Bayesian SITAR model 

# To avoid mode estimation which takes time, the Bayesian SITAR model fit to 
# the 'berkeley_exdata' has been saved as an example fit ('berkeley_exfit').
# See 'bsitar' function for details on 'berkeley_exdata' and 'berkeley_exfit'.

# Check and confirm whether the model fit object 'berkeley_exfit' exists
 berkeley_exfit <- getNsObject(berkeley_exfit)

model <- berkeley_exfit

# Speed up examples by using a subset of posterior draws
draw_ids <- 1:5

## Example 1: Hypothesis testing (brms-style)

set_hypothesis <- c("a_Intercept = 0", "b_Intercept > 1")

# brms reference
hyp_ex1 <- brms::hypothesis(model, hypothesis = set_hypothesis, draw_ids = draw_ids)

# hypothesis_test (auto-detects brms engine)
hyp_ex11 <- hypothesis_test(model, 
                           draw_ids = draw_ids,
                           hypothesis_str = set_hypothesis)

# If see package is installed (install.packages("see")), then you can plot it 
# plot(hyp_ex1)
# plot(hyp_ex11)

## Example 2: ROPE equivalence testing (bayestestR)

set_parameters <- c("b_a_Intercept", "b_b_Intercept")
set_range <- list(b_a_Intercept = c(100, 150), b_b_Intercept = c(-2, 2))

# bayestestR reference - If you installed bayestestR package
# hyp_ex1 <- bayestestR::equivalence_test(model, 
#                                      parameters = set_parameters, 
#                                      range = set_range,
#                                      draw_ids = draw_ids)

# hypothesis_test (auto-detects bayestestR engine)
# If see package is installed (install.packages("see")), then you can plot 
# the results by setting plot = TRUE
hyp_ex11 <- hypothesis_test(model,
                           draw_ids = draw_ids,
                           parameters = set_parameters,
                           range = set_range,
                           plot = FALSE)

# print(hyp_ex1)
print(hyp_ex11)

# Note: bayestestR often ignores parameters/effects for nonlinear bsitar models.
# hypothesis_test correctly respects user-specified parameters.

## Example 3: p-direction testing (bayestestR)

set_parameters <- c("b_a_Intercept", "b_b_Intercept")
set_null <- list(b_a_Intercept = 0, b_b_Intercept = 0)

# bayestestR reference - If you installed bayestestR package
# hyp_ex1 <- bayestestR::p_direction(model, 
#                                 parameters = set_parameters,
#                                 null = set_null,
#                                 draw_ids = draw_ids)

# hypothesis_test (auto-detects bayestestR engine)
# If see package is installed (install.packages("see")), then you can plot 
# the results by setting plot = TRUE
hyp_ex11 <- hypothesis_test(model,
                           draw_ids = draw_ids,
                           parameters = set_parameters,
                           null = set_null,
                           plot = FALSE,
                           equivalence_test = FALSE,
                           p_direction = TRUE)

# print(hyp_ex1)
print(hyp_ex11)

## Example 4: Growth parameter hypothesis testing (marginaleffects)

set_parameter <- c("apgv", "pgv")
set_range <- list(apgv = 1, pgv = c(0, 0.5))
set_null <- list(apgv = 1, pgv = 0)

# Directly using marginal_growthparameters()
hyp_ex1 <- marginal_growthparameters(model, 
                                    parameter = set_parameter,
                                    draw_ids = draw_ids)
# Uncomment for ROPE/p-direction tests:
# equivalence_test = list(range = set_range),
# p_direction = list(null = set_null)

## Example 5: hypothesis_test() with growth parameters

hyp_ex1 <- hypothesis_test(model,
                          parameter = set_parameter,
                          equivalence_test = list(range = set_range),
                          p_direction = list(null = set_null),
                          draw_ids = draw_ids)

## Example 6: Pass posterior draws from marginal_growthparameters()

# pdrawsp = TRUE returns draws for downstream hypothesis testing
hyp_draws <- marginal_growthparameters(model,
                                      parameter = set_parameter,
                                      pdrawsp = TRUE,
                                      equivalence_test = list(range = set_range),
                                      p_direction = list(null = set_null),
                                      draw_ids = draw_ids)

# Use draws directly in hypothesis_test()
hyp_ex1 <- hypothesis_test(hyp_draws,
                          parameter = set_parameter,
                          equivalence_test = list(range = set_range),
                          p_direction = list(null = set_null),
                          draw_ids = draw_ids)

}

}
\seealso{
\itemize{
\item \code{\link[brms:hypothesis.brmsfit]{brms::hypothesis()}} for hypothesis testing.
\item \code{\link[bayestestR:equivalence_test]{bayestestR::equivalence_test()}} for ROPE tests.
\item \code{\link[bayestestR:p_direction]{bayestestR::p_direction()}} for probability of direction tests.
\item \code{\link[marginaleffects:comparisons]{marginaleffects::comparisons()}} for prediction contrasts.
}
}
\author{
Satpal Sandhu  \email{satpal.sandhu@bristol.ac.uk}
}
